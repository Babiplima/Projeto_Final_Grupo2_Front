import React, { Component } from "react";
import PubSub from "pubsub-js";

import {
  Table,
  Button,
  Form,
  FormGroup,
  Label,
  Input,
  Alert,
  Row
  } from "reactstrap";

class ListBeneficio extends Component {
  delete = (id) => {
    this.props.deleteBeneficio(id);
  };
  onEdit = (beneficio) => {
    PubSub.publish("edit-beneficio", beneficio);
  };

  render() {
    const { beneficios } = this.props;
    return (
      <Table className="table-bordered text-center">
        <thead className="thead-dark">
          <tr>
            <th>Nome</th>
            <th>Descrição</th>
            <th>Link</th>
            <th>NivelZupper</th>
            </tr>
        </thead>
        <tbody>
          {beneficios.map((beneficio) => (
            <tr key={beneficio.id}>
              <td>{beneficio.nome}</td>
              <td>{beneficio.descricao}</td>
              <td>{beneficio.link}</td>
              <td>{beneficio.nivelZupper}</td>
              <td>
                <Button
                  color="danger"
                  size="sm"
                  onClick={(e) => this.delete(beneficio.id)}
                >
                  DELETAR
                </Button>
              </td>
            </tr>
          ))}
        </tbody>
      </Table>
    );
  }
}

  class FormAtividadeFisica extends Component {
    state = {
      model: {
        nome: "",
        descricao: "",
        link: "",
        nivelZupper:""        
        },
    };
  
    componentWillMount() {
      PubSub.subscribe("edit-beneficio", (topic, beneficio) => {
        this.setState({ model: beneficio});
      });
    }
  
    setValues = (e, field) => {
      const { model } = this.state;
      model[field] = e.target.value;
      this.setState({ model });
    };
  
    create = () => {
      this.setState({ model: {
        nome: "",
        descricao: "",
        link: "",
        nivelZupper:""
        } });
      this.props.atividadeCreate(this.state.model);
    };
  
    render() {
      return (
        <Form>
          <FormGroup>
            <div className="form-row">
              <Label for="nome"> Nome </Label>
              <Input
                id="nome"
                type="text"
                value={this.state.model.nome}
                placeholder="Informe o nome do benefício"
                onChange={(e) => this.setValues(e, "nome")}
              />
            </div>
          </FormGroup>
          <FormGroup>
            <div className="form-row">
              <Label for="Descricao">Descricao</Label>
              <Input
                id="descricao"
                type="text"
                value={this.state.model.descricao}
                placeholder="Informe a descrição deste benefício:"
                onChange={(e) => this.setValues(e, "beneficio")}
              />
            </div>
          </FormGroup>
          <FormGroup>
            <div className="form-row">
              <Label for="link"> Link </Label>
              <Input
                id="link"
                type="text"
                value={this.state.model.link}
                placeholder="Coloque aqui o link para o acesso do benefício"
                onChange={(e) => this.setValues(e, "link")}
              />
            </div>
          </FormGroup>
          <FormGroup>
            <div className="form-row">
              <Label for="nivelZupper"> NivelZupper </Label>
              <Input
                id="nivelZupper"
                type="text"
                value={this.state.model.nivelZupper}
                placeholder="Informe o nível do ZUPPER para obter este benefício"
                onChange={(e) => this.setValues(e, "beneficio")}
              />
            </div>
          </FormGroup>          
          <Button color="primary" block onClick={this.create}>
            ATUALIZAR
          </Button>
        </Form>
      );
    }
  }
  
  class DashboardBeneficio extends Component {
    url = "http://localhost:8080/beneficio";
  
    state = {
     atividades: [],
      message: {
        text: "",
        alert: "",
      },
    };
  
    componentDidMount() {
      let token = localStorage.getItem("token");
      const requestInfo = {
        method: "GET",
        headers: new Headers({
          "Content-type": "application/json",
          Authorization: token,
        }),
      };
      fetch(this.url, requestInfo)
        .then((response) => response.json())
        .then((beneficios) => this.setState({ beneficios}))
        .catch((e) => console.log(e));
    }
  
    save = (beneficio) => {
        let data = {
          nome: beneficio.nome,
          descricao: beneficio.descricao,
          link: beneficio.link,
          nivelZupper: beneficio.nivelZupper
         } ;
        // Pegar o token para atualizar o valor
        // const token = localStorage.getItem("token");
        const requestInfo = {
          method: "PUT",
          body: JSON.stringify(data),
          headers: new Headers({
            "Content-type": "application/json",
           // "const token": localStorage.getItem("token")
            // enviar token no cabeçario da requisição
            // Authorization: token,
          }),
        };
        fetch(this.url, requestInfo)
          .then((response) => response.json())
          .then((newBeneficio) => {
            let { beneficio } = this.state;
            beneficios.push(newBeneficio);
            this.setState({
              beneficios,
              message: { text: "Benefício atualizado com sucesso. ", alert: "success" },
            });
            this.timerMessage(3000);
          })
          .catch((e) => console.log(e));
      };
  
    timerMessage = (duration) => {
      setTimeout(() => {
        this.setState({ message: { text: "", alert: "" } });
      }, duration);
    };
  
    delete = (id) => {
      const token = localStorage.getItem("token");
      const requestInfo = {
        method: "DELETE",
        headers: new Headers({
          "Content-type": "application/json",
          Authorization: token,
        }),
      };
      fetch(`${this.url}/${id}`, requestInfo)
        .then((rows) => {
          const beneficios = this.state.beneficios.filter((beneficio) => beneficio.id !== id);
          this.setState({
            beneficios,
            message: { text: "Benefício excluído com sucesso. ", alert: "danger" },
          });
          this.timerMessage(3000);
        })
        .catch((e) => console.log(e));
    };
  
    render() {
      return (
        <div>
          {this.state.message.text !== "" ? (
            <Alert color={this.state.message.alert} className="text-center">
              {this.state.message.text}
            </Alert>
          ) : (
            ""
          )}
          <div className="row">
            <div className="col-md-6 my-3">
              <h2 className="font-weight-bold text-center">Atualizar Beneficio</h2>
              <FormBeneficio BeneficioCreate={this.save} />
            </div>
            <div className="col-md-6 my-3">
              <h2 className="font-weight-bold text-center">Lista de beneficios </h2>
              <ListBeneficios beneficios={this.state.beneficios} deleteBeneficio={this.delete} />
            </div>
          </div>
        </div>
      );
    }
  }
  export default DashboardBeneficio;
  